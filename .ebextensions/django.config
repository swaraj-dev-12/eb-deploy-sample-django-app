option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: ebdjango.wsgi

packages:
  yum:
    nginx: []

container_commands:
  01_migrate:
    command: "python manage.py migrate"
    leader_only: true

files:
  "/etc/nginx/conf.d/nginx.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      worker_processes 1;

      events {
          worker_connections 1024;
      }

      http {
          include /etc/nginx/mime.types;
          default_type application/octet-stream;
          sendfile on;
          keepalive_timeout 65;

          upstream django {
              server 127.0.0.1:8000;
          }

          server {
              listen 80;
              server_name _;

              location / {
                  proxy_pass http://django;
                  proxy_set_header Host $host;
                  proxy_set_header X-Real-IP $remote_addr;
                  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                  proxy_set_header X-Forwarded-Proto $scheme;
              }
          }
      }
